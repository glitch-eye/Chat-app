<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng k√Ω Peer ƒë∆°n gi·∫£n</title>
    <style>
        /* CSS t·ªëi gi·∫£n ƒë·ªÉ d·ªÖ ƒë·ªçc */
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 350px; margin: auto; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"] { width: 95%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 3px; }
        input[type="submit"] { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #message { margin-top: 10px; padding: 5px; border: 1px solid transparent; }
        .error { color: #cc0000; border-color: #fdd; background-color: #ffe0e0; }
        .success { color: #008000; border-color: #dfd; background-color: #e0ffe0; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üîó ƒêƒÉng k√Ω Th√¥ng tin Peer</h2>
        
        <form id="peer-register-form">
            
            <label for="username">T√™n ng∆∞·ªùi d√πng (Username):</label>
            <input type="text" id="username" name="username" required 
                   placeholder="V√≠ d·ª•: peer_alice">
            
            <label for="peer_ip">ƒê·ªãa ch·ªâ IP:</label>
            <input type="text" id="peer_ip" name="peer_ip" required 
                   placeholder="V√≠ d·ª•: 192.168.1.100 (IP N·ªôi b·ªô)">
            
            <label for="peer_port">C·ªïng (Port):</label>
            <input type="text" id="peer_port" name="peer_port" required 
                   placeholder="V√≠ d·ª•: 8001">
            
            <input type="submit" value="ƒêƒÉng k√Ω Peer">
        </form>
        
        <div id="message"></div>
        
        <p style="font-size: 0.8em; margin-top: 20px;">
            *Th√†nh c√¥ng s·∫Ω chuy·ªÉn h∆∞·ªõng ƒë·∫øn <code>/add-list</code>.
        </p>
    </div>

    <script>
        const form = document.getElementById('peer-register-form');
        const messageDiv = document.getElementById('message');
        const submitButton = form.querySelector('input[type="submit"]');

        form.addEventListener('submit', async function(e) {
            e.preventDefault(); 
            messageDiv.textContent = '';
            messageDiv.className = '';
            submitButton.disabled = true;

            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => data[key] = value);

            try {
                const response = await fetch('/submit-info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.status === 200) {
                    // ‚úÖ TH√ÄNH C√îNG: Chuy·ªÉn h∆∞·ªõng ƒë·∫øn /add-list
                    messageDiv.textContent = '‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang k√≠ch ho·∫°t Peer Client...';
                    messageDiv.className = 'success';
                    
                    // Ch·∫°y GET /add-list/
                    setTimeout(() => {
                        window.location.href = '/add-list/'; 
                    }, 500); // Chuy·ªÉn h∆∞·ªõng sau 0.5 gi√¢y
                    
                } else {
                    // ‚ùå L·ªñI: Hi·ªÉn th·ªã l·ªói
                    const statusText = response.statusText || 'L·ªói Server';
                    let errorDetails = `L·ªói ${response.status} (${statusText}).`;
                    
                    try {
                        const errorData = await response.json();
                        errorDetails = errorData.message || errorDetails;
                    } catch (e) {
                        // Kh√¥ng l√†m g√¨ n·∫øu body kh√¥ng ph·∫£i JSON
                    }

                    messageDiv.textContent = `‚ùå ƒêƒÉng k√Ω th·∫•t b·∫°i: ${errorDetails}`;
                    messageDiv.className = 'error';
                }

            } catch (error) {
                // L·ªói m·∫°ng ho·∫∑c l·ªói k·∫øt n·ªëi
                messageDiv.textContent = '‚ùå L·ªói k·∫øt n·ªëi m·∫°ng.';
                messageDiv.className = 'error';
            } finally {
                // Ch·ªâ reset n√∫t n·∫øu kh√¥ng ph·∫£i l√† tr·∫°ng th√°i th√†nh c√¥ng 200
                if (response.status !== 200) {
                    submitButton.disabled = false;
                }
            }
        });
    </script>
</body>
</html>